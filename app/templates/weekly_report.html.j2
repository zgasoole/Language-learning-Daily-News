<!doctype html>
<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Weekly Learning Report</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        background: #f2f4f8;
        color: #1b232d;
        font-family: 'Trebuchet MS', 'Segoe UI', sans-serif;
      }
      .wrapper {
        max-width: 760px;
        margin: 24px auto;
        background: #fff;
        border: 1px solid #dfe6ee;
        border-radius: 16px;
        overflow: hidden;
      }
      .hero {
        padding: 28px;
        background: linear-gradient(130deg, #d7f5ea, #dfe8ff);
      }
      .hero h1 {
        margin: 0 0 8px;
        font-size: 26px;
      }
      .hero p {
        margin: 0;
        color: #415366;
      }
      .section {
        padding: 22px 28px;
        border-top: 1px solid #edf2f7;
      }
      .section h2 {
        margin: 0 0 12px;
        font-size: 20px;
      }
      .kpi-row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .kpi {
        border: 1px solid #dbe4ee;
        border-radius: 10px;
        padding: 10px 12px;
        background: #fafcff;
        min-width: 130px;
      }
      .kpi .label {
        color: #67788a;
        font-size: 12px;
      }
      .kpi .value {
        font-size: 22px;
        font-weight: 700;
      }
      ul {
        margin: 0;
        padding-left: 18px;
      }
      li {
        margin: 6px 0;
      }
      .footer {
        padding: 16px 28px;
        font-size: 12px;
        color: #6d7a88;
        background: #f8fbff;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <div class="hero">
        <h1>学习周报</h1>
        <p>{{ today }} · 周期 {{ report.range_label }}</p>
      </div>

      <div class="section">
        <h2>核心数据</h2>
        <div class="kpi-row">
          <div class="kpi"><div class="label">本周课程数</div><div class="value">{{ report.lessons_count }}</div></div>
          <div class="kpi"><div class="label">反馈动作数</div><div class="value">{{ report.feedback_count }}</div></div>
          <div class="kpi"><div class="label">词库总量</div><div class="value">{{ report.vocab_total }}</div></div>
          <div class="kpi"><div class="label">语法库总量</div><div class="value">{{ report.grammar_total }}</div></div>
        </div>
      </div>

      <div class="section">
        <h2>词汇反馈分布（本周）</h2>
        <ul>
          <li>完全不懂：{{ report.word_unknown }}</li>
          <li>隐约懂点：{{ report.word_fuzzy }}</li>
          <li>熟悉：{{ report.word_known }}</li>
        </ul>
      </div>

      <div class="section">
        <h2>当前词库掌握分布（累计）</h2>
        <ul>
          <li>熟悉：{{ report.vocab_known_total }}</li>
          <li>隐约懂点：{{ report.vocab_fuzzy_total }}</li>
          <li>完全不懂：{{ report.vocab_unknown_total }}</li>
        </ul>
      </div>

      <div class="section">
        <h2>重点复习词（完全不懂）</h2>
        {% if report.top_unknown_words %}
        <ul>
          {% for item in report.top_unknown_words %}
          <li>{{ item[0] }} · {{ item[1] }} 次</li>
          {% endfor %}
        </ul>
        {% else %}
        <p>本周没有“完全不懂”反馈。</p>
        {% endif %}
      </div>

      <div class="section">
        <h2>重点复习词（隐约懂点）</h2>
        {% if report.top_fuzzy_words %}
        <ul>
          {% for item in report.top_fuzzy_words %}
          <li>{{ item[0] }} · {{ item[1] }} 次</li>
          {% endfor %}
        </ul>
        {% else %}
        <p>本周没有“隐约懂点”反馈。</p>
        {% endif %}
      </div>

      <div class="section">
        <h2>语法掌握进度</h2>
        <ul>
          <li>累计已掌握：{{ report.grammar_mastered_total }}</li>
          <li>本周新标记已掌握：{{ report.grammar_marked_this_week }}</li>
        </ul>
      </div>

      <div class="section">
        <h2>本周课程回顾</h2>
        {% if report.recent_lessons %}
        <ul>
          {% for lesson in report.recent_lessons %}
          <li>{{ lesson.created_at }} · {{ lesson.title }}</li>
          {% endfor %}
        </ul>
        {% else %}
        <p>本周暂未生成课程记录。</p>
        {% endif %}
      </div>

      <div class="footer">Weekly report generated by GitHub Actions.</div>
    </div>
  </body>
</html>
